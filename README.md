# XPathGenie

> **"Rub the lamp, get the XPath."**
> ã€Œ3ã¤ã®é¡˜ã„ã¯ã„ã‚‰ãªã„ã€‚URLã ã‘ãã‚Œã€‚ã€

URLã‚’å…¥åŠ›ã™ã‚‹ã ã‘ã§ã€ãƒšãƒ¼ã‚¸ã‹ã‚‰å–å¾—å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿è¦ç´ ã¨XPathãƒãƒƒãƒ”ãƒ³ã‚°ã‚’AIãŒè‡ªå‹•ç”Ÿæˆã™ã‚‹Webã‚¢ãƒ—ãƒªã€‚

## ä½•ãŒã§ãã‚‹ï¼Ÿ

1. è§£æã—ãŸã„ãƒšãƒ¼ã‚¸ã®URLã‚’2ã€œ3å€‹å…¥åŠ›
2. AIãŒãƒšãƒ¼ã‚¸æ§‹é€ ã‚’è§£æã—ã€å–å¾—å¯èƒ½ãªè¦ç´ ã‚’ç™ºè¦‹
3. å„è¦ç´ ã®XPathã¨æ±ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’è‡ªå‹•ç”Ÿæˆ
4. è¤‡æ•°ãƒšãƒ¼ã‚¸ã§æ¤œè¨¼æ¸ˆã¿ã®ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ä»˜ã

AIã‚’ä½¿ã†ã®ã¯**ãƒãƒƒãƒ”ãƒ³ã‚°ç”Ÿæˆæ™‚ã®1å›ã ã‘**ã€‚ç”Ÿæˆã•ã‚ŒãŸXPathã§ä»¥é™ã¯AIä¸è¦ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ãŒå¯èƒ½ã€‚

## Genie, Aladdin & Jasmine â€” 3ã¤ã®ãƒ„ãƒ¼ãƒ«

### ğŸ§ XPathGenieï¼ˆGenerate â€” ç”Ÿæˆï¼‰

AIãŒXPathãƒãƒƒãƒ”ãƒ³ã‚°ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ã€‚2ã¤ã®ãƒ¢ãƒ¼ãƒ‰ã‚’æŒã¤ï¼š

- **Auto Discover** â€” URLã ã‘æ¸¡ã›ã°AIãŒå…¨è¦ç´ ã‚’è‡ªå‹•ç™ºè¦‹
- **Want List** â€” æ¬²ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®JSONã‚¹ã‚­ãƒ¼ãƒã‚’æ¸¡ã—ã¦ç‹™ã„æ’ƒã¡

### ğŸª” XPathAladdinï¼ˆAnalyze â€” æ¤œè¨¼ï¼‰

GenieãŒç”Ÿæˆã—ãŸXPathã‚’å®Ÿãƒšãƒ¼ã‚¸ã§æ¤œè¨¼ã™ã‚‹ãƒªã‚µãƒ¼ãƒãƒ„ãƒ¼ãƒ«ã€‚

- **æœ€å¤§10 URLã‚’ä¸€æ‹¬ãƒ†ã‚¹ãƒˆ** â€” å…¨ãƒšãƒ¼ã‚¸ã§XPathãŒé€šã‚‹ã‹ç¢ºèª
- **ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ** â€” ãƒšãƒ¼ã‚¸ã”ã¨ã®æŠ½å‡ºçµæœã‚’æ¯”è¼ƒ
- **ã‚¯ãƒ­ã‚¹ãƒšãƒ¼ã‚¸ãƒ’ãƒƒãƒˆç‡** â€” ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã«ä½•ãƒšãƒ¼ã‚¸ã§å€¤ãŒå–ã‚ŒãŸã‹è¡¨ç¤º
- **XPathãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç·¨é›†** â€” ãã®å ´ã§ä¿®æ­£ã—ã¦å³å†è©•ä¾¡
- **Genieã¨ã®é€£æº** â€” ã€ŒOpen in Aladdinã€ãƒœã‚¿ãƒ³ã§URL+ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’è‡ªå‹•å¼•ãç¶™ã

### ğŸŒ¸ XPathJasmineï¼ˆJoin â€” ã‚»ã‚¯ã‚·ãƒ§ãƒ³é¸æŠï¼‰

åˆ†æå‰ã«ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç¯„å›²ã‚’ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«é¸æŠã™ã‚‹ãƒ„ãƒ¼ãƒ«ã€‚

- **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‹ã‚¯ãƒªãƒƒã‚¯é¸æŠ** â€” fetchã—ãŸãƒšãƒ¼ã‚¸ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã—ã€åˆ†æå¯¾è±¡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã§æŒ‡å®š
- **Include/Exclude** â€” ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆç·‘æ ï¼‰ã¨é™¤å¤–éƒ¨åˆ†ï¼ˆèµ¤æ ï¼‰ã‚’è¦–è¦šçš„ã«é¸æŠ
- **é¸æŠçµæœã‚’Genieã«å¼•ãæ¸¡ã—** â€” localStorageã‚’é€šã˜ã¦ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«é€£æº
- **i18nå¯¾å¿œ** â€” æ—¥æœ¬èª/è‹±èªUIåˆ‡ã‚Šæ›¿ãˆ
- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰HTMLæŠ½å‡º** â€” é¸æŠç¯„å›²ã®HTMLã‚’ãƒ–ãƒ©ã‚¦ã‚¶å´ã§æŠ½å‡ºã—ã¦ã‹ã‚‰APIã«é€ä¿¡

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```
Jasmine: URLå…¥åŠ› â†’ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ â†’ ã‚»ã‚¯ã‚·ãƒ§ãƒ³é¸æŠï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
                                        â†“
Genie: URLå…¥åŠ› â†’ AIåˆ†æ â†’ XPathãƒãƒƒãƒ”ãƒ³ã‚°ç”Ÿæˆ â†’ [Open in Aladdin]
                                                        â†“
Aladdin: 10ãƒšãƒ¼ã‚¸ä¸€æ‹¬Fetch â†’ XPathæ¤œè¨¼ â†’ æ‰‹ä¿®æ­£ â†’ Export (JSON/YAML)
```

localStorageå…±æœ‰ã§G-A-Jé–“ã‚’ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«é€£æºã€‚

## 2ã¤ã®ãƒ¢ãƒ¼ãƒ‰ï¼ˆGenieï¼‰

### Auto Discoverï¼ˆè‡ªå‹•ç™ºè¦‹ï¼‰

URLã‚’å…¥ã‚Œã‚‹ã ã‘ã€‚AIãŒãƒšãƒ¼ã‚¸ã‚’è¦‹ã¦ã€Œã“ã®ã‚µã‚¤ãƒˆã‹ã‚‰ã¯ã“ã‚ŒãŒå–ã‚Œã‚‹ã€ã¨è¦ç´ ã‚’è‡ªå‹•ç™ºè¦‹ã—ã€æ±ç”¨çš„ãªè‹±èªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’ä»˜ä¸ã™ã‚‹ã€‚

```
å…¥åŠ›: URL Ã— 2ã€œ3
å‡ºåŠ›: {"salary": "//dt[text()='çµ¦ä¸']/following-sibling::dd[1]", ...}
```

### Want Listï¼ˆæŒ‡å®šãƒ¢ãƒ¼ãƒ‰ï¼‰

æ¬²ã—ã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®JSONã‚¹ã‚­ãƒ¼ãƒã‚’æ¸¡ã™ã¨ã€ãã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã«åˆã†XPathã‚’è¿”ã™ã€‚

```json
{
  "facility_name": "å‹¤å‹™å…ˆã®æ–½è¨­åãƒ»ä¼šç¤¾å",
  "price": "çµ¦ä¸ãƒ»æ™‚çµ¦ãƒ»æœˆçµ¦",
  "contract": "é›‡ç”¨å½¢æ…‹ï¼ˆæ­£ç¤¾å“¡ã€å¥‘ç´„ç¤¾å“¡ã€ãƒ‘ãƒ¼ãƒˆç­‰ï¼‰",
  "working_hours": ""
}
```

- **å€¤ã«èª¬æ˜ã‚’æ›¸ã** â†’ AIãŒæ„å›³ã‚’æ­£ç¢ºã«ç†è§£ã—ã¦æœ€é©ãªXPathã‚’é¸ã¶
- **å€¤ã‚’ç©ºã«ã™ã‚‹** â†’ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‹ã‚‰æ„å‘³ã‚’æ¨è«–ã—ã¦ãƒãƒƒãƒ”ãƒ³ã‚°
- Auto Discoverã‚ˆã‚Šãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»ãŒå°‘ãªã„ï¼ˆç´„30%æ¸›ï¼‰

## è‡ªå‹•ç²¾åº¦å‘ä¸Šï¼ˆRefineæ©Ÿèƒ½ï¼‰

XPathGenieã¯ç”Ÿæˆå¾Œã«**è‡ªå‹•ã§ç²¾åº¦ã‚’ä¸Šã’ã‚‹**ä»•çµ„ã¿ã‚’æŒã¤ã€‚

### å•é¡Œ: 1ã¤ã®XPathãŒè¤‡æ•°ã®è¦ç´ ã«ãƒãƒƒãƒã™ã‚‹

æ±‚äººã‚µã‚¤ãƒˆã§ã¯åŒã˜ãƒ©ãƒ™ãƒ«ï¼ˆã€Œå‹¤å‹™åœ°ã€ã€Œæ±‚äººIDã€ç­‰ï¼‰ãŒãƒ˜ãƒƒãƒ€ãƒ¼ã€è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€ã‚µã‚¤ãƒ‰ãƒãƒ¼ãªã©è¤‡æ•°ç®‡æ‰€ã«å‡ºç¾ã™ã‚‹ã€‚å˜ç´”ãªXPathã ã¨å…¨ç®‡æ‰€ã«ãƒãƒƒãƒã—ã¦ã—ã¾ã†ã€‚

### è§£æ±º: 2æ®µéšã®Refine

```
AIç”Ÿæˆ â†’ Validate â†’ è¤‡æ•°ãƒãƒƒãƒæ¤œå‡º â†’ Refine â†’ å†Validate
```

#### åŒã˜å€¤ã®é‡è¤‡ â†’ æ©Ÿæ¢°çš„çµã‚Šè¾¼ã¿ï¼ˆAIä¸è¦ã€ã‚³ã‚¹ãƒˆ0ï¼‰

æ±‚äººIDãŒãƒ˜ãƒƒãƒ€ãƒ¼ã€ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ã€è©³ç´°ã«3å›å‡ºã‚‹å ´åˆï¼š

```
Before: //div[contains(@class,'p-offerContainer')]//div[contains(@class,'c-favoriteBtn')]/@data-job_id
â†’ 3 matches (same value)

After:  //div[contains(@class,'p-offerContainer')]//div[contains(@class,'p-jobDetail-body')]//div[contains(@class,'c-favoriteBtn')]/@data-job_id
â†’ 1 match
```

å…¨ãƒãƒƒãƒè¦ç´ ã®ç¥–å…ˆãƒã‚§ãƒ¼ãƒ³ã‹ã‚‰ã‚¯ãƒ©ã‚¹ã‚’æ¢ç´¢ã—ã€1ä»¶ã«çµã‚Œã‚‹ä¸­é–“ã‚³ãƒ³ãƒ†ãƒŠã‚’è‡ªå‹•æŒ¿å…¥ã™ã‚‹ã€‚

#### ç•°ãªã‚‹å€¤ã®é‡è¤‡ â†’ AIã«Refineä¾é ¼

è©³ç´°ã®ã€Œå‹¤å‹™åœ°ã€ã¨ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã€ŒãŠã™ã™ã‚æ±‚äººã®å‹¤å‹™åœ°ã€ã§å€¤ãŒç•°ãªã‚‹å ´åˆã€å‘¨è¾ºHTMLæ§‹é€ ã‚’AIã«æ¸¡ã—ã¦ã€Œã©ã¡ã‚‰ãŒãƒ¡ã‚¤ãƒ³ã‹ã€ã‚’åˆ¤æ–­ã•ã›ã‚‹ã€‚

```
AI: "p-jobDetail-bodyå†…ã®æ–¹ãŒè©³ç´°æƒ…å ± â†’ ã“ã¡ã‚‰ã‚’æ¡ç”¨"
â†’ ä¸­é–“ãƒ‘ã‚¹ã‚’å«ã‚€ã‚ˆã‚Šå…·ä½“çš„ãªXPathã‚’è¿”å´
```

### æ·±ã•å„ªå…ˆã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°

è¤‡æ•°ãƒãƒƒãƒã®é‡ã¿ã¥ã‘ã«ã¯DOMéšå±¤ã®æ·±ã•ã‚‚è€ƒæ…®ã•ã‚Œã‚‹ã€‚æµ…ã„è¦ç´ ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆç­‰ï¼‰ã‚ˆã‚Šæ·±ã„è¦ç´ ï¼ˆè©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ï¼‰ãŒå„ªå…ˆã•ã‚Œã‚‹ã€‚

```python
score += depth  # æ·±ã„ã»ã©ã‚¹ã‚³ã‚¢åŠ ç®—ï¼ˆmain/articleç­‰ã®æ§‹é€ ã‚·ã‚°ãƒŠãƒ«ã¨ä½µç”¨ï¼‰
```

**è¨­è¨ˆæ€æƒ³:** äººé–“ãŒã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã™ã‚‹æ™‚ã¨åŒã˜ã€‚ã¾ãšAIãŒå…¨éƒ¨ã‚„ã£ã¦ã€åˆ¤æ–­ãŒå¿…è¦ãªã¨ã“ã‚ã ã‘äººé–“ãŒAladdinã§ç¢ºèªã™ã‚‹ã€‚å½¹å‰²ãŒé€†è»¢ã—ãŸã ã‘ã§ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ§‹é€ ã¯åŒã˜ã€‚

## çµæœã®è¦‹æ–¹

| é …ç›® | èª¬æ˜ |
|------|------|
| Field | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åï¼ˆãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§ãƒªãƒãƒ¼ãƒ å¯ï¼‰ |
| XPath | ç”Ÿæˆã•ã‚ŒãŸXPathå¼ |
| Confidence | ä¿¡é ¼åº¦ï¼ˆå…¨URLã§å€¤ãŒå–ã‚ŒãŸå‰²åˆï¼‰ã€‚100%=å…¨ãƒšãƒ¼ã‚¸ã§å–å¾—æˆåŠŸ |
| Samples | å„URLã‹ã‚‰å®Ÿéš›ã«å–å¾—ã•ã‚ŒãŸå€¤ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ |
| refined ãƒãƒƒã‚¸ | Refineæ©Ÿèƒ½ã§è‡ªå‹•ä¿®æ­£ã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ |

### ä¿¡é ¼åº¦ã®èª­ã¿æ–¹

- **100%** â€” å…¨ãƒšãƒ¼ã‚¸ã§å€¤ãŒå–ã‚ŒãŸã€‚å®‰å®šã—ã¦ä½¿ãˆã‚‹
- **67%** â€” 3ãƒšãƒ¼ã‚¸ä¸­2ãƒšãƒ¼ã‚¸ã§å–ã‚ŒãŸã€‚ãƒšãƒ¼ã‚¸ã«ã‚ˆã£ã¦å­˜åœ¨ã—ãªã„è¦ç´ ã®å¯èƒ½æ€§
- **0%** â€” å€¤ãŒå–ã‚Œãªã‹ã£ãŸã€‚XPathãŒä¸æ­£ã‹ã€compressorã®åœ§ç¸®ã§æ§‹é€ ãŒå¤±ã‚ã‚ŒãŸå¯èƒ½æ€§

## ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

çµæœã¯3ã¤ã®æ–¹æ³•ã§åˆ©ç”¨ã§ãã‚‹:

### JSON
```json
{
  "facility_name": "//dt[text()='å‹¤å‹™å…ˆ']/following-sibling::dd[1]",
  "salary": "//dt[text()='çµ¦ä¸']/following-sibling::dd[1]"
}
```

### YAMLï¼ˆteddy_crawleräº’æ›ï¼‰
```yaml
mapping:
  facility_name: "//dt[text()='å‹¤å‹™å…ˆ']/following-sibling::dd[1]"
  salary: "//dt[text()='çµ¦ä¸']/following-sibling::dd[1]"
```

### Open in Aladdin
çµæœã‚’ãã®ã¾ã¾Aladdinã«å¼•ãæ¸¡ã—ã¦å®Ÿãƒšãƒ¼ã‚¸æ¤œè¨¼ã€‚

## ä½¿ã„æ–¹ã®ã‚³ãƒ„

### è‰¯ã„URLé¸ã³ã®ãƒã‚¤ãƒ³ãƒˆ

- **åŒã˜ã‚µã‚¤ãƒˆã®åŒã˜ç¨®é¡ã®ãƒšãƒ¼ã‚¸**ã‚’2ã€œ3å€‹å…¥ã‚Œã‚‹ï¼ˆè©³ç´°ãƒšãƒ¼ã‚¸åŒå£«ã€ä¸€è¦§ãƒšãƒ¼ã‚¸åŒå£«ï¼‰
- URLãŒå¤šã„ã»ã©æ¤œè¨¼ã®ä¿¡é ¼åº¦ãŒä¸ŠãŒã‚‹ãŒã€3å€‹ã‚ã‚Œã°ååˆ†
- ä¸€è¦§ãƒšãƒ¼ã‚¸ã¨è©³ç´°ãƒšãƒ¼ã‚¸ã¯åˆ¥ã€…ã«è§£æã™ã‚‹

### ç²¾åº¦ã‚’ä¸Šã’ã‚‹ã«ã¯

- Want Listãƒ¢ãƒ¼ãƒ‰ã§å€¤ã«ãƒ’ãƒ³ãƒˆã‚’æ›¸ãï¼ˆä¾‹: `"contract": "é›‡ç”¨å½¢æ…‹ï¼ˆæ­£ç¤¾å“¡ã€ãƒ‘ãƒ¼ãƒˆç­‰ï¼‰"`ï¼‰
- ä¿¡é ¼åº¦0%ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã£ãŸã‚‰ã€Auto Discoverã§å…¨è¦ç´ ã‚’ç¢ºèªã—ã¦ã¿ã‚‹
- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒªãƒãƒ¼ãƒ  â†’ è‡ªåˆ†ã®ã‚¹ã‚­ãƒ¼ãƒã«åˆã‚ã›ã‚‰ã‚Œã‚‹
- Jasmineã§ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’äº‹å‰é¸æŠã™ã‚‹ã¨ã€ãƒã‚¤ã‚ºã®å¤šã„ã‚µã‚¤ãƒˆã§ã‚‚ç²¾åº¦å‘ä¸Š

### æ³¨æ„ç‚¹

- **SSRã‚µã‚¤ãƒˆï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰å‘ã‘**ã€‚SPAã‚µã‚¤ãƒˆï¼ˆJavaScriptå‹•çš„ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰ã¯HTMLã‚½ãƒ¼ã‚¹ã«å€¤ãŒãªã„ãŸã‚è§£æã§ããªã„
- **AIã®è§£æã¯å®Œç’§ã§ã¯ãªã„**ã€‚ç”Ÿæˆã•ã‚ŒãŸXPathã¯å¿…ãšä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ã‚’ç¢ºèªã™ã‚‹ã“ã¨
- **ã‚µã‚¤ãƒˆæ§‹é€ ãŒå¤‰ã‚ã‚‹ã¨XPathãŒå£Šã‚Œã‚‹**ã€‚å®šæœŸã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹å ´åˆã¯å®šæœŸçš„ã«å†è§£æã‚’æ¨å¥¨
- **1å›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§æœ€å¤§10URL**ã€‚ãã‚Œä»¥ä¸Šã¯ãƒãƒƒãƒåˆ†å‰²ã—ã¦ãã ã•ã„
- **Gemini APIã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¶ˆè²»ã™ã‚‹**ã€‚1å›ã‚ãŸã‚Šç´„8,000ã€œ18,000ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆãƒ¢ãƒ¼ãƒ‰ã¨ãƒšãƒ¼ã‚¸æ§‹é€ ã«ã‚ˆã‚‹ï¼‰
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: APIã¯30ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ†ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚ã‚Šã€‚Origin/Refererãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚‚å®Ÿæ–½

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| é …ç›® | æŠ€è¡“ |
|------|------|
| Backend | Python / Flask |
| Frontend | Vue 3 (CDN) / Vanilla CSS |
| AI | Gemini 2.5 Flash |
| HTMLè§£æ | lxml |
| ãƒ†ãƒ¼ãƒ | ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ + glassmorphism |

## å®Ÿç¸¾

| ã‚µã‚¤ãƒˆ | ãƒšãƒ¼ã‚¸æ•° | ãƒˆãƒ¼ã‚¯ãƒ³ | æ‰€è¦æ™‚é–“ | ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ•° | ä¿¡é ¼åº¦100% |
|--------|----------|----------|----------|-------------|-----------|
| ãƒ„ã‚¯ã‚¤ã‚¹ã‚¿ãƒƒãƒ• | 4 | 15,032 | 27.1ç§’ | 20 | 20/20 (100%) |
| ã‚­ãƒ£ãƒ‡ã‚£ã‚«ãƒ« | 3 | 8,749 | 12.3ç§’ | 23 | 23/23 (100%) |

å¾“æ¥ã®æ‰‹ä½œæ¥­: **1ã‚µã‚¤ãƒˆ5ã€œ6æ™‚é–“** Ã— 33ã‚µã‚¤ãƒˆ = **150ã€œ200æ™‚é–“**
XPathGenie: **1ã‚µã‚¤ãƒˆ30ç§’** Ã— 33ã‚µã‚¤ãƒˆ = **ç´„15åˆ†**

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
XPathGenie/
â”œâ”€â”€ app.py                  # Flask API ã‚µãƒ¼ãƒãƒ¼
â”œâ”€â”€ index.html              # Genie ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”œâ”€â”€ aladdin.html            # Aladdin ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”œâ”€â”€ jasmine.html            # Jasmine ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ genie/                  # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ fetcher.py          # HTMLå–å¾—ï¼ˆSSRFé˜²å¾¡ï¼‰
â”‚   â”œâ”€â”€ compressor.py       # HTMLæ§‹é€ åœ§ç¸®
â”‚   â”œâ”€â”€ analyzer.py         # Gemini APIå‘¼ã³å‡ºã—
â”‚   â””â”€â”€ validator.py        # XPathæ¤œè¨¼ãƒ»Refine
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html          # Flask root routeç”¨
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ js/
â”‚   â””â”€â”€ images/
â”œâ”€â”€ wallpapers/             # å£ç´™ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ images/
â”œâ”€â”€ scripts/                # è©•ä¾¡ãƒ»å®Ÿé¨“ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ evaluate_site.py
â”‚   â””â”€â”€ ...
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ whitepaper.md
â”‚   â”œâ”€â”€ ISSUES.md
â”‚   â”œâ”€â”€ evaluation/         # å®Ÿé¨“ãƒ¬ãƒãƒ¼ãƒˆãƒ»çµæœ
â”‚   â””â”€â”€ proposals/          # è¨­è¨ˆææ¡ˆ
â”œâ”€â”€ README.md
â””â”€â”€ LICENSE
```

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
graph TD
    A["Genie: URLå…¥åŠ› (2~10å€‹)"] --> B[fetcher: HTMLå–å¾—<br/>SSRFé˜²å¾¡ä»˜ã]
    B --> C[compressor: æ§‹é€ åœ§ç¸®<br/>695KB â†’ 20KB]
    C --> D[analyzer: Gemini 2.5 Flash<br/>XPathãƒãƒƒãƒ”ãƒ³ã‚°ç”Ÿæˆ]
    D --> E[validator: å…¨ãƒšãƒ¼ã‚¸ã§<br/>XPathå®Ÿè¡Œãƒ»ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢]
    E --> F{è¤‡æ•°ãƒãƒƒãƒ<br/>æ¤œå‡º?}
    F -- åŒã˜å€¤ --> G[æ©Ÿæ¢°çš„çµè¾¼<br/>ä¸­é–“ã‚¯ãƒ©ã‚¹è‡ªå‹•æŒ¿å…¥<br/>ã‚³ã‚¹ãƒˆ0]
    F -- ç•°ãªã‚‹å€¤ --> H[AI Refine<br/>å‘¨è¾ºHTMLã§å†æ¨è«–]
    F -- ãªã— --> I[æœ€çµ‚çµæœ]
    G --> J[å†Validate]
    H --> J
    J --> I

    I --> K["Open in Aladdin"]
    K --> L["Aladdin: 10ãƒšãƒ¼ã‚¸ä¸€æ‹¬Fetch"]
    L --> M[ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ¤œè¨¼<br/>ã‚¯ãƒ­ã‚¹ãƒšãƒ¼ã‚¸ãƒ’ãƒƒãƒˆç‡]
    M --> N[XPathæ‰‹ä¿®æ­£<br/>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å†è©•ä¾¡]
    N --> O["Export: JSON / YAML"]

    style A fill:#7c5cfc,color:#fff
    style D fill:#9f7aea,color:#fff
    style G fill:#4caf50,color:#fff
    style H fill:#ff9800,color:#fff
    style K fill:#7c5cfc,color:#fff
    style O fill:#4caf50,color:#fff
```

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- Python 3.9+
- Gemini APIã‚­ãƒ¼ï¼ˆä»¥ä¸‹ã„ãšã‚Œã‹ã®æ–¹æ³•ã§è¨­å®šï¼‰

### APIã‚­ãƒ¼ã®è¨­å®šï¼ˆBYOK â€” Bring Your Own Keyï¼‰

XPathGenieã¯**BYOKæ–¹å¼**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã®Gemini APIã‚­ãƒ¼ã‚’æŒã¡è¾¼ã‚“ã§åˆ©ç”¨ã—ã¾ã™ã€‚

#### æ–¹æ³•1: Web UIã§å…¥åŠ›ï¼ˆæ¨å¥¨ï¼‰

1. [Google AI Studio](https://aistudio.google.com/apikey) ã§Gemini APIã‚­ãƒ¼ã‚’å–å¾—ï¼ˆç„¡æ–™æ ã‚ã‚Šï¼‰
2. XPathGenieã®Web UIã§APIã‚­ãƒ¼æ¬„ã«å…¥åŠ›
3. ã€ŒRemember keyã€ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã¨ãƒ–ãƒ©ã‚¦ã‚¶ã®localStorageã«ä¿å­˜ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

è©³ã—ãã¯ [Setup Guide](setup-guide.html) ã‚’å‚ç…§ã€‚

#### æ–¹æ³•2: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰è¨­å®šï¼ˆé–‹ç™ºãƒ»ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆç”¨ï¼‰

```bash
# APIã‚­ãƒ¼ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«é…ç½®
mkdir -p ~/.config/google
echo "YOUR_API_KEY" > ~/.config/google/gemini_api_key

# ã‚µãƒ¼ãƒãƒ¼ã‚­ãƒ¼ã§ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¨±å¯ï¼ˆç’°å¢ƒå¤‰æ•°ï¼‰
export XPATHGENIE_ALLOW_SERVER_KEY=1
```

> âš ï¸ å…¬é–‹ã‚µãƒ¼ãƒãƒ¼ã§ã¯ `XPATHGENIE_ALLOW_SERVER_KEY` ã‚’è¨­å®šã—ãªã„ã§ãã ã•ã„ã€‚å…¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚µãƒ¼ãƒãƒ¼ã‚ªãƒ¼ãƒŠãƒ¼ã®APIã‚­ãƒ¼ã§èª²é‡‘ã•ã‚Œã¾ã™ã€‚

> ğŸ”’ **æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãšHTTPSçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚** APIã‚­ãƒ¼ãŒPOSTãƒœãƒ‡ã‚£ã«å«ã¾ã‚Œã‚‹ãŸã‚ã€HTTPã§ã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§å‚å—ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

> âš ï¸ **ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·åˆ©ç”¨æ™‚ã®æ³¨æ„:** Rate Limiterã¯ `X-Forwarded-For` ãƒ˜ãƒƒãƒ€ãƒ¼ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIPã‚’è­˜åˆ¥ã—ã¾ã™ã€‚ã“ã‚Œã¯ä¿¡é ¼ã§ãã‚‹ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ï¼ˆApache, nginxç­‰ï¼‰ã®èƒŒå¾Œã§ã®ã¿å®‰å…¨ã§ã™ã€‚XPathGenieã‚’ç›´æ¥ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«å…¬é–‹ã™ã‚‹å ´åˆã€æ”»æ’ƒè€…ãŒãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å½è£…ã—ã¦Rate Limitã‚’å›é¿ã§ãã¾ã™ã€‚æœ¬æ ¼çš„ãªSaaSåŒ–æ™‚ã«ã¯Flaskã® [ProxyFix](https://werkzeug.palletsprojects.com/en/latest/middleware/proxy_fix/) ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®å°å…¥ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pip install flask lxml requests
```

### èµ·å‹•

```bash
python3 app.py
# â†’ http://localhost:8789
```

### systemdã‚µãƒ¼ãƒ“ã‚¹ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰

```ini
[Unit]
Description=XPathGenie Flask API
After=network.target

[Service]
Type=simple
User=ec2-user
WorkingDirectory=/path/to/XPathGenie
ExecStart=/usr/bin/python3 -u app.py
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl enable xpathgenie
sudo systemctl start xpathgenie
```

### Apacheé€£æºï¼ˆãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ï¼‰

```apache
ProxyPass /xpathgenie/api/ http://127.0.0.1:8789/api/ flushpackets=on timeout=60
ProxyPassReverse /xpathgenie/api/ http://127.0.0.1:8789/api/
```

é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã¯Apacheã®Alias or ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã§é…ä¿¡ã€‚

## API

### POST /api/analyze

```json
// Request â€” Auto Discover
{
  "urls": [
    "https://example.com/detail?id=100",
    "https://example.com/detail?id=101"
  ],
  "api_key": "YOUR_GEMINI_API_KEY"
}

// Request â€” Want List
{
  "urls": [
    "https://example.com/detail?id=100",
    "https://example.com/detail?id=101"
  ],
  "api_key": "YOUR_GEMINI_API_KEY",
  "wantlist": {
    "title": "ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«",
    "price": "ä¾¡æ ¼ãƒ»æ–™é‡‘",
    "location": ""
  }
}

// Response (success)
{
  "status": "ok",
  "site": "example.com",
  "mappings": {
    "title": {
      "xpath": "//h1[contains(@class,'title')]",
      "confidence": 1.0,
      "samples": ["æ±‚äººã‚¿ã‚¤ãƒˆãƒ«A", "æ±‚äººã‚¿ã‚¤ãƒˆãƒ«B"],
      "optional": false
    }
  },
  "pages_analyzed": 2,
  "pages_failed": 0,
  "tokens_used": 8749,
  "elapsed_seconds": 12.3,
  "refined_fields": ["original_id"],
  "diagnostics": {
    "compressed_size_bytes": 15234
  }
}

// Response (error)
{
  "status": "error",
  "reason": "fetch_failed",
  "message": "Failed to fetch all URLs",
  "suggestion": "Check if the site requires JavaScript rendering (SPA).",
  "diagnostics": {}
}
```

### GET /api/fetch?url=...

Aladdinç”¨ã®ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰HTMLãƒ•ã‚§ãƒƒãƒï¼ˆCORSå›é¿ï¼‰ã€‚

```json
// Response
{
  "html": "<html>...",
  "url": "https://example.com/page"
}
```

## ãŠã¾ã‘

- **Wallpapers** â€” XPathGenieãƒ†ãƒ¼ãƒã®å£ç´™ã‚®ãƒ£ãƒ©ãƒªãƒ¼ (`/wallpapers/`)

## ãƒ›ãƒ¯ã‚¤ãƒˆãƒšãƒ¼ãƒ‘ãƒ¼

æŠ€è¡“çš„ãªè©³ç´°ã¯ [Technical Whitepaper](docs/whitepaper.md) ã‚’å‚ç…§ã€‚

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License â€” see [LICENSE](LICENSE)

## Author

goodsun
