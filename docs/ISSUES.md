# XPathGenie — Issues

## Open

### #1 コンプレッサーがメインコンテンツを見落とす
- **重要度**: High
- **発見日**: 2026-02-17
- **対象サイト**: bestcareer, 他にも影響の可能性あり
- **症状**: HTMLは正しく取得・デコードされるが、`_find_main_section()`がテーブルを含むメインコンテンツ領域を見落とし、結果としてcompressed HTMLにテーブルが含まれない → AIが0フィールドを返す
- **原因**: `<main>`/`<article>`タグがないサイトでは最大テキスト量のdivを選ぶが、テーブルがネストされた構造だとテキスト量判定で負ける。またheader/navがdivベース（class="headWrap"等）の場合、STRIP_TAGSで除去されず圧縮結果に残る
- **対策案**:
  1. th/td, dt/dd を含むセクションをメインコンテンツ候補として優先
  2. NOISE_PATTERNSにheadWrap/navBox等を追加
  3. フォールバック: `_find_main_section`が小さすぎる結果を返したらdoc全体を使う

### #2 Shift-JISサイトでGenie分析タイムアウト (mc-pharma)
- **重要度**: Medium
- **発見日**: 2026-02-17
- **対象サイト**: mc-pharma
- **症状**: エンコーディング修正後もGenie分析でタイムアウト（5分超）。リトライ前はcompressed HTMLが文字化けしたまま分析に投入されていた
- **原因**: 未調査。エンコーディング修正後の再テスト必要。コンプレッサーの問題（#1）と複合している可能性
- **対策案**: エンコーディング修正 + コンプレッサー修正後に再テスト

### #3 ph-10, cadical でGenie解析が0フィールド
- **重要度**: Medium
- **発見日**: 2026-02-17
- **対象サイト**: ph-10, cadical
- **症状**: リトライしても0フィールド。bestcareerと同じコンプレッサー問題の可能性
- **原因**: 未調査
- **対策案**: #1 修正後に再テスト

### #4 低精度サイトのDOM構造不一致 (phget, yakuzaishisyusyoku)
- **重要度**: Medium
- **発見日**: 2026-02-17
- **対象サイト**: phget (14.3%), yakuzaishisyusyoku (38.5%)
- **症状**: Genieが推定したXPathパターンが実際のDOM構造と合わない。ヘッダ系フィールドは取れるが詳細テーブルは全滅
- **原因**: サイトのHTML構造が非標準（phget: テーブルではなくdivベース、yakuzaishisyusyoku: spanベースのテキストとテーブルの混在）
- **対策案**:
  1. DOM構造の事前分析 → パターン分類
  2. 複数XPath戦略の生成・比較
  3. 低精度フィールドの自動再生成（フォールバック）

### #5 caresta の部分的XPath不一致
- **重要度**: Low
- **発見日**: 2026-02-17
- **対象サイト**: caresta (50.0%)
- **症状**: preceding-sibling軸を使った複雑なXPathが一部ページで不一致。「仕事情報」セクションは取れるが「給与・待遇」「施設情報」セクションは取れない
- **原因**: テーブルのセクション構造（h3見出し）がページによって異なる可能性
- **対策案**: XPath生成時にpreceding-sibling依存を減らす、またはページ差異を検出して警告

---

## Resolved

### ✅ Shift-JIS/EUC-JPエンコーディング非対応
- **解決日**: 2026-02-17
- **対策**: fetcher.pyにmeta charset自動検出 + フォールバックデコード追加
- **コミット**: 24234e7

### ✅ XHTML (XML宣言付き) パース失敗
- **解決日**: 2026-02-17
- **対策**: compressor.pyでXML宣言とDOCTYPEを除去してからパース
- **コミット**: 24234e7

### ✅ API失敗時の理由が不明
- **解決日**: 2026-02-17
- **対策**: app.pyのレスポンスにstatus/reason/suggestion/diagnostics追加
- **コミット**: 24234e7
