# XPathGenie 評価レポート

**評価日:** 2026-02-17（リトライ含む）
**対象:** 求人サイト 35サイト中 24サイトを評価対象とし、21サイトで評価完了

---

## 総合サマリー

| 指標 | 値 |
|---|---|
| 評価対象 | 24 / 35サイト（11サイトはSPA/アクセス不可で対象外） |
| 評価完了 | 21 / 24サイト（3サイトはGenie解析失敗） |
| 総フィールド数 | 324 |
| Perfect（100%一致） | 249 / 324（76.9%） |
| 100%サイト数 | 10 / 21（47.6%） |
| 90%以上サイト数 | 13 / 21（61.9%） |
| 加重平均ヒット率 | **79.5%** |
| 平均Genie処理時間 | 約20s |

### 評価対象外サイト（11件）
- **アクセス不可**: #3(403), #17(500), #23(ログイン必須)
- **SPA（詳細ページ）**: #7, #11, #15, #22, #27, #28, #29
- **未取得**: #33（詳細リンク不明）

### Genie解析失敗（3件）
- **#12 bestcareer**: Genieが0フィールドを返却（Shift-JISエンコーディングの可能性）
- **#31 ph-10**: Genieが0フィールドを返却（HTML構造の解析失敗）
- **#34 cadical**: Genieが0フィールドを返却（一覧SPA、詳細SSRだが構造解析失敗）

### Genie解析タイムアウト（1件）
- **#30 mc-pharma**: Shift-JISエンコーディングで文字化け、Genie分析がタイムアウト（リトライ前の結果: 5.3%）

---

## ランク別一覧

### 🏆 Perfect（100%）— 10サイト

| # | サイト | 分野 | フィールド数 | Genie時間 |
|---|---|---|---|---|
| 2 | selva-i | 薬剤師 | 1 | 9.0s |
| 9 | oshigoto-lab | 医療 | 16 | 8.4s |
| 13 | pharmapremium | 薬剤師 | 20 | 25.3s |
| 18 | nikken-care | 介護 | 17 | 10.3s |
| 19 | nikken-nurse | 看護 | 17 | 7.8s |
| 20 | cocofump | 介護 | 4 | 16.0s |
| 21 | MRT-nurse | 看護 | 11 | 31.9s |
| 24 | kaigo-work | 介護 | 14 | 11.5s |
| 25 | w-medical-9 | 医療 | 20 | 31.1s |
| 26 | firstnavi | 看護 | 1 | 12.8s |

### ◎ 高精度（90%〜99%）— 3サイト

| # | サイト | 分野 | フィールド数 | Perfect | ヒット率 |
|---|---|---|---|---|---|
| 32 | yakusta | 薬剤師 | 18 | 17/18 | 98.3% |
| 16 | pharmalink | 薬剤師 | 20 | 16/20 | 96.5% |
| 35 | kaigokango | 介護看護 | 20 | 19/20 | 96.0% |

### ○ 中精度（50%〜89%）— 5サイト

| # | サイト | 分野 | フィールド数 | Perfect | ヒット率 |
|---|---|---|---|---|---|
| 4 | yakumatch | 薬剤師 | 19 | 17/19 | 89.5% |
| 1 | tsukui-staff | 介護 | 20 | 14/20 | 82.5% |
| 8 | apuro | 薬剤師 | 13 | 10/13 | 80.8% |
| 5 | mynavi | 薬剤師 | 20 | 15/20 | 78.5% |
| 14 | caresta | 介護 | 20 | 10/20 | 50.0% |

### △ 低精度（〜49%）— 3サイト

| # | サイト | 分野 | フィールド数 | Perfect | ヒット率 | 原因 |
|---|---|---|---|---|---|---|
| 10 | yakuzaishisyusyoku | 薬剤師 | 20 | 7/20 | 38.5% | DOM構造不一致 |
| 6 | phget | 薬剤師 | 14 | 2/14 | 14.3% | DOM構造不一致 |
| 30 | mc-pharma | 薬剤師 | 19 | 1/19 | 5.3% | Shift-JIS文字化け |

### ❌ 失敗 — 3サイト

| # | サイト | 原因 |
|---|---|---|
| 12 | bestcareer | Genie解析が0フィールド（Shift-JIS） |
| 31 | ph-10 | Genie解析が0フィールド |
| 34 | cadical | Genie解析が0フィールド |

---

## リトライ効果

インフラ増強（3.8GB→7.6GB RAM）後にリトライした結果：

| # | サイト | 1回目 | リトライ | 変化 |
|---|---|---|---|---|
| 13 | pharmapremium | 31.6% | **100%** | +68.4pt ✨ |
| 5 | mynavi | 58.0% | **78.5%** | +20.5pt |
| 8 | apuro | 73.1% | **80.8%** | +7.7pt |
| 10 | yakuzaishisyusyoku | 33.5% | 38.5% | +5.0pt |
| 6 | phget | 10.0% | 14.3% | +4.3pt |
| 14 | caresta | 50.0% | 50.0% | 変化なし |
| 12 | bestcareer | 失敗 | 失敗 | 変化なし |
| 31 | ph-10 | 失敗 | 失敗 | 変化なし |
| 34 | cadical | 失敗 | 失敗 | 変化なし |
| 30 | mc-pharma | 5.3% | タイムアウト | — |

**pharmapremiumの劇的改善**（31.6%→100%）はインフラ負荷が原因だったことを裏付ける。
失敗が再現した4サイトはサイト構造側の問題（エンコーディング、HTML構造）。

---

## 失敗パターン分析

### パターン1: エンコーディング問題（mc-pharma, bestcareer）
- Shift-JIS等の非UTF-8エンコーディングにより文字化け
- XPathのtext()マッチが壊れたテキストと照合されるため全滅
- **対策**: Content-Type / meta charset 検出 → 自動デコード

### パターン2: DOM構造不一致（phget, yakuzaishisyusyoku）
- Genieが推定したDOM構造パターン（dt/dd, th/td）が実際の構造と異なる
- ヘッダ系（job_title, salary等）は取れるが、テーブル内詳細はすべて失敗
- **対策**: DOM構造の事前分析 → パターン分類後にXPath生成戦略を切り替え

### パターン3: Genie解析失敗（ph-10, cadical）
- HTMLは取得できるがGenieが0フィールドを返す
- 原因不明（HTML構造が複雑すぎる、またはコンプレッサーが有効な構造を残せない）
- **対策**: 失敗時の診断情報（compressed HTML size, detected structure等）をレスポンスに含める

### パターン4: CSSクラス依存（caresta）
- preceding-sibling軸を使った複雑なXPathが一部ページで不一致
- テーブルのセクション構造がページによって異なる
- **対策**: フォールバック戦略（初回XPathが低精度の場合、代替パターンで再生成）

---

## 高精度サイトの共通点

1. **th/td構造のテーブル**（oshigoto-lab, kaigo-work, w-medical-9, pharmapremium）→ Genieの得意パターン
2. **dt/dd定義リスト**（nikken-care, nikken-nurse）→ 同様に高精度
3. **明確なclass名を持つセマンティックHTML** → XPath生成が安定
4. **全ページで統一された構造** → cross-pageヒット率が自然に高い

---

## 改善ロードマップ

### Phase 1: 失敗理由の明示化（即対応）
- Genie APIレスポンスに `status` / `reason` / `suggestion` フィールドを追加
- 検出可能な失敗理由: `spa_detected`, `encoding_unsupported`, `analysis_failed`, `timeout`
- UI側で失敗理由を表示

### Phase 2: エンコーディング対応
- Content-Type / meta charset 自動検出
- Shift-JIS, EUC-JP 等への対応

### Phase 3: DOM事前分析
- テーブル/リスト/カード等のパターン自動分類
- パターンに応じたXPath生成戦略の切り替え

### Phase 4: フォールバック戦略
- 初回XPathが低精度の場合、代替パターンで再生成
- A/Bテスト的にXPathを比較し最良を選択

---

## データファイル

| ファイル | 内容 |
|---|---|
| `results/*.json` | 各サイトの個別評価結果（XPath + ヒット率 + サンプル値） |
| `xpathgenie_eval_summary.json` | 全サイト統合JSON（workspace内） |
| `url_lists.txt` | 評価用URL一覧 |
| `info.txt` | サイト構造分析データ |
