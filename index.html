<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XPathGenie</title>
  <link rel="stylesheet" href="static/css/style.css">
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>
<body>
  <div id="app">
    <div class="container">
      <header class="hero">
        
        <img src="static/images/genie.png" class="genie" alt="Genie">
        <h1>XPathGenie</h1>
        <p class="tagline">Rub the lamp, get the XPath.</p>
      <nav class="nav-pair"><span class="current">Genie (Generate)</span> <a href="aladdin.html">Aladdin (Analyze)</a> <a href="jasmine.html">Jasmine (Join)</a> <a href="whitepaper.html">Whitepaper</a></nav>
      </header>

      <div class="card input-card">
        <div style="margin-bottom: 12px;">
          <label>Gemini API Key <span class="hint">(<a href="setup-guide.html" target="_blank" style="color:#b366ff;">How to get one</a>)</span></label>
          <div style="display:flex; align-items:center; gap:8px;">
            <input :type="showKey ? 'text' : 'password'" v-model="apiKey" placeholder="AIza..." style="flex:1; font-family:monospace;" :disabled="loading">
            <button @click="showKey=!showKey" type="button" style="background:none;border:1px solid #ddd;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:0.8rem;">{{ showKey ? 'üôà' : 'üëÅÔ∏è' }}</button>
          </div>
          <div style="margin-top:4px; display:flex; align-items:flex-start; gap:6px;">
            <label style="font-size:0.75rem; color:#888; cursor:pointer; white-space:nowrap; display:flex; align-items:center; gap:3px;">
              <input type="checkbox" v-model="rememberKey"> Remember key
            </label>
          </div>
        </div>

        <label>Enter URLs <span class="hint">(one per line, 2-10 recommended)</span></label>
        <textarea v-model="urlText" placeholder="https://example.com/page/1&#10;https://example.com/page/2&#10;https://example.com/page/3" rows="5" :disabled="loading"></textarea>

        <div class="mode-toggle">
          <button @click="mode='discover'" :class="{active: mode==='discover'}" class="mode-btn">Auto Discover</button>
          <button @click="mode='wantlist'" :class="{active: mode==='wantlist'}" class="mode-btn">Want List</button>
        </div>

        <div v-if="mode==='wantlist'" class="wantlist-section">
          <label>Want List <span class="hint">(JSON schema ‚Äî keys = desired field names)</span></label>
          <textarea v-model="wantlistText" :placeholder="wantlistPlaceholder" rows="8" :disabled="loading" class="wantlist-input"></textarea>
        </div>

        <button @click="analyzeUrls" :disabled="loading || !urlText.trim()" class="btn-analyze">
          <span v-if="!loading">Analyze</span>
          <span v-else>Genie is working... {{ elapsedStr }}</span>
        </button>
      </div>

      <div v-if="error" class="card error-card">
        <strong>Error:</strong> {{ error }}
      </div>

      <div v-if="result" class="card result-card">
        <div class="result-header">
          <h2>{{ result.site }}</h2>
          <div class="stats">
            <span>{{ result.pages_analyzed }} pages</span>
            <span>{{ result.tokens_used }} tokens</span>
            <span>{{ result.elapsed_seconds }}s</span>
          </div>
        </div>

        <table class="result-table">
          <thead>
            <tr>
              <th>Field</th>
              <th>XPath</th>
              <th>Confidence</th>
              <th>Samples</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(info, field) in result.mappings" :key="field" :class="{'low-confidence': info.confidence < 0.5}">
              <td>
                <input v-if="editing === field" v-model="editName" @keyup.enter="renameField(field)" @blur="renameField(field)" class="edit-input" ref="editInput">
                <span v-else @dblclick="startEdit(field)" class="field-name" :title="'Double-click to rename'">{{ field }}</span>
              </td>
              <td class="xpath-cell" :title="info.xpath">{{ info.xpath }}</td>
              <td>
                <div class="confidence-bar">
                  <div class="confidence-fill" :style="{width: (info.confidence*100)+'%', background: confidenceColor(info.confidence)}"></div>
                  <span>{{ Math.round(info.confidence*100) }}%</span>
                </div>
              </td>
              <td class="samples-cell">
                <span v-for="(s, i) in info.samples" :key="i" class="sample" :class="{missing: !s}">{{ s || '---' }}</span>
                <div v-if="info.warning" class="warning-msg">{{ info.warning }}</div>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="export-bar">
          <button @click="copyJSON" class="btn-export">Copy JSON</button>
          <button @click="copyYAML" class="btn-export">Copy YAML</button>
          <span v-if="copied" class="copied-msg">Copied!</span>
        </div>
      </div>
    </div>
  </div>
  <script src="static/js/app.js"></script>
<!-- Genie mascot -->
<div style="position:fixed; bottom:0; right:0; height:300px; width:300px; z-index:9999; pointer-events:none; overflow:hidden;">
<img src="wallpapers/images/genie_bustup.png" style="height:350px; position:absolute; bottom:-150px; right:-80px;" alt="Genie">
</div>
</body>
</html>
